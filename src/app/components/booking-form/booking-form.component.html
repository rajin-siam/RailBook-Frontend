<div class="container">
  <div class="booking-card">
    <h1>ðŸš‚ Train Ticket Booking</h1>
    
    <form [formGroup]="bookingForm" (ngSubmit)="onSubmit()">
      <!-- Trip Details -->
      <div class="section">
        <h2>Trip Details</h2>
        
        <div class="form-row">
          <div class="form-group">
            <label>Booking Date & Time *</label>
            <input type="datetime-local" formControlName="bookingDate" class="form-control">
            <div class="error" *ngIf="bookingForm.get('bookingDate')?.touched && bookingForm.get('bookingDate')?.errors">
              Date is required
            </div>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>Source *</label>
            <select formControlName="source" class="form-control">
              <option value="">Select Source</option>
              <option *ngFor="let city of cities" [value]="city">{{ city }}</option>
            </select>
            <div class="error" *ngIf="bookingForm.get('source')?.touched && bookingForm.get('source')?.errors">
              Source is required
            </div>
          </div>

          <div class="form-group">
            <label>Destination *</label>
            <select formControlName="destination" class="form-control">
              <option value="">Select Destination</option>
              <option *ngFor="let city of cities" [value]="city">{{ city }}</option>
            </select>
            <div class="error" *ngIf="bookingForm.get('destination')?.touched && bookingForm.get('destination')?.errors">
              Destination is required
            </div>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>Price Per Ticket (BDT) *</label>
            <input type="number" formControlName="perTicketPrice" class="form-control" placeholder="753">
            <div class="error" *ngIf="bookingForm.get('perTicketPrice')?.touched && bookingForm.get('perTicketPrice')?.errors">
              Valid price is required
            </div>
          </div>
        </div>
      </div>

      <!-- Passengers -->
      <div class="section">
        <div class="section-header">
          <h2>Passengers</h2>
          <button type="button" class="btn btn-primary" (click)="addPassenger()">+ Add Passenger</button>
        </div>

        <div formArrayName="passengers">
          <div *ngFor="let passenger of passengers.controls; let i = index" class="passenger-card" [formGroupName]="i">
            <div class="passenger-header">
              <h3>Passenger {{ i + 1 }}</h3>
              <button type="button" class="btn btn-danger-small" (click)="removePassenger(i)" *ngIf="passengers.length > 1">
                Remove
              </button>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label>Name *</label>
                <input type="text" formControlName="name" class="form-control" placeholder="Enter name">
              </div>

              <div class="form-group">
                <label>Age *</label>
                <input type="number" formControlName="age" class="form-control" placeholder="25">
              </div>

              <div class="form-group">
                <label>Gender *</label>
                <select formControlName="gender" class="form-control">
                  <option value="">Select Gender</option>
                  <option *ngFor="let gender of genders" [value]="gender">{{ gender }}</option>
                </select>
              </div>
            </div>

            <!-- Train Services -->
            <div class="services-section">
              <div class="service-header">
                <label>Train Services</label>
              </div>

              <div class="service-chips">
                <button type="button" 
                        class="service-chip" 
                        *ngFor="let service of availableServices"
                        (click)="selectService(i, service.name, service.price)">
                  {{ service.name }} - {{ service.price }} BDT
                </button>
              </div>

              <div formArrayName="trainServices">
                <div *ngFor="let service of getServices(i).controls; let j = index" 
                     class="service-item" 
                     [formGroupName]="j">
                  <input type="text" formControlName="serviceName" class="form-control" placeholder="Service name" readonly>
                  <input type="number" formControlName="price" class="form-control" placeholder="Price" readonly>
                  <button type="button" class="btn btn-danger-small" (click)="removeService(i, j)">Ã—</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Summary -->
      <div class="summary">
        <div class="summary-row">
          <span>Tickets ({{ passengers.length }} Ã— {{ bookingForm.get('perTicketPrice')?.value || 0 }} BDT):</span>
          <span>{{ passengers.length * (bookingForm.get('perTicketPrice')?.value || 0) }} BDT</span>
        </div>
        <div class="summary-row total">
          <span><strong>Total Amount:</strong></span>
          <span><strong>{{ calculateTotal() }} BDT</strong></span>
        </div>
      </div>

      <div class="error" *ngIf="errorMessage">{{ errorMessage }}</div>

      <button type="submit" class="btn btn-success btn-large" [disabled]="isSubmitting">
        {{ isSubmitting ? 'Processing...' : 'Confirm Booking' }}
      </button>
    </form>
  </div>
</div>
